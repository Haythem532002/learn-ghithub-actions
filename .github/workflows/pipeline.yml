name: Learn CI/CD Pipeline using Github Actions

on:
  push:
    branches: main
  workflow_dispatch:

env:                       # 🌍 Global env variables (for all jobs/steps)
  APP_ENV: production
# on: push
# on: pull_request
# on:
#   schedule:            # cron-like syntax
#     - cron: "0 0 * * *"  # runs every day at midnight
jobs:
  build:
    runs-on: ubuntu-latest
    outputs: 
      message: ${{ steps.step1.outputs.msg }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Hello World
        run: echo "Hello World" 
      - name: check node version
        run: node -v
        
      - name: print env var
        run: echo $DOCKER_USERNAME
        
      - name: print app env
        run: echo $APP_ENV

      - name: print secret
        run: echo ${{ secrets.DOCKER_PASSWORD }}

        
      - name: Run only on main
        if: github.ref == 'refs/heads/main'
        run: echo "I run only on main branch"
      - id: step1
        run: echo "msg=Hello From Build Job" >> $GITHUB_OUTPUT

  deploy:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Get the ouput from build job
        run: echo ${{needs.build.outputs.message}}
      - name: call workflow
        uses: ./github/workflows/setup_node.yml
        with:
          node-version: 20

